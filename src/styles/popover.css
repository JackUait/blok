/**
 * Popover styles - Tailwind version
 *
 * Uses @apply where possible, CSS variables for dynamic values set via JS
 */

/* Popover CSS Variables - kept for JS integration and dynamic calculations */
.blok-popover {
  /* Design tokens */
  --border-radius: theme('borderRadius.lg');
  --width: 200px;
  --max-height: 270px;
  --padding: theme('spacing.1');
  --offset-from-target: theme('spacing.2');
  --color-border: theme('colors.gray.200', #eff0f1);
  --color-shadow: rgba(13, 20, 33, 0.1);
  --color-background: theme('colors.white');
  --color-text-primary: theme('colors.black');
  --color-text-secondary: theme('colors.gray.500', #707684);
  --color-border-icon: rgb(201 201 204 / 48%);
  --color-border-icon-disabled: theme('colors.gray.200', #eff0f1);
  --color-text-icon-active: theme('colors.blue.500', #388ae5);
  --color-background-icon-active: rgba(56, 138, 229, 0.1);
  --color-background-item-focus: rgba(34, 186, 255, 0.08);
  --color-shadow-item-focus: rgba(7, 161, 227, 0.08);
  --color-background-item-hover: theme('colors.gray.100', #f8f8f8);
  --color-background-item-confirm: theme('colors.red.500', #e24a4a);
  --color-background-item-confirm-hover: theme('colors.red.600', #ce4343);

  /* Positioning variables (set via JS) */
  --popover-top: calc(100% + var(--offset-from-target));
  --popover-left: 0;
  --nested-popover-overlap: theme('spacing.1');
  --icon-size: theme('spacing.5');
  --item-padding: 3px;
  --item-height: calc(var(--icon-size) + 2 * var(--item-padding));
}

.blok-popover__container {
  @apply absolute flex flex-col overflow-hidden box-border opacity-0 pointer-events-none p-0 border-none z-[4] max-h-0;
  min-width: var(--width);
  width: var(--width);
  border-radius: var(--border-radius);
  box-shadow: 0 3px 15px -3px var(--color-shadow);
  left: var(--popover-left);
  top: var(--popover-top);
  background: var(--color-background);

  /* Mobile container styles */
  @apply mobile:fixed mobile:max-w-none mobile:rounded-[10px];

  @screen mobile {
    --offset: 5px;
    min-width: calc(100% - var(--offset) * 2);
    inset: auto var(--offset) calc(var(--offset) + env(safe-area-inset-bottom)) var(--offset);
  }
}

.blok-popover--opened > .blok-popover__container {
  @apply opacity-100 pointer-events-auto;
  animation: panelShowing 100ms ease;
  padding: var(--padding);
  max-height: var(--max-height);
  border: 1px solid var(--color-border);

  @screen mobile {
    animation: panelShowingMobile 250ms ease;
  }
}

.blok-popover--open-top .blok-popover__container {
  --popover-top: calc(-1 * (var(--offset-from-target) + var(--popover-height)));
}

.blok-popover--open-left .blok-popover__container {
  --popover-left: calc(-1 * var(--width) + 100%);
}

.blok-popover__overlay {
  @apply hidden bg-dark mobile:fixed mobile:inset-0 mobile:block mobile:visible mobile:z-[3] mobile:opacity-50 mobile:transition-opacity mobile:duration-[120ms] mobile:ease-in mobile:will-change-[opacity];

  &--hidden {
    @apply hidden;
  }
}

/* Nested popover positioning */
.blok-popover--nested .blok-popover__container {
  /* Variables --nesting-level and --trigger-item-top are set via JS */
  --popover-left: calc(var(--nesting-level) * (var(--width) - var(--nested-popover-overlap)));
  @apply absolute;
  top: calc(var(--trigger-item-top) - var(--nested-popover-overlap));
}

.blok-popover--open-top.blok-popover--nested .blok-popover__container {
  top: calc(var(--trigger-item-top) - var(--popover-height) + var(--item-height) + var(--offset-from-target) + var(--nested-popover-overlap));
}

.blok-popover--open-left .blok-popover--nested .blok-popover__container {
  --popover-left: calc(-1 * (var(--nesting-level) + 1) * var(--width) + 100%);
}

/**
 * Popover item separator
 */
.blok-popover-item-separator {
  @apply py-1 px-[3px];

  &--hidden {
    @apply hidden;
  }
}

.blok-popover-item-separator__line {
  @apply h-px w-full;
  background: var(--color-border);
}

/**
 * Popover item HTML
 */
.blok-popover-item-html--hidden {
  @apply hidden;
}

/**
 * Popover item
 */
.blok-popover-item {
  --border-radius: theme('borderRadius.md');
  @apply flex items-center select-none border-none bg-transparent rounded-md mobile:p-1;
  padding: var(--item-padding);
  color: var(--color-text-primary);

  &:not(:last-of-type) {
    @apply mb-px;
  }

  &--active {
    background: var(--color-background-icon-active);
    color: var(--color-text-icon-active);
  }

  &--disabled {
    @apply cursor-default pointer-events-none;
    color: var(--color-text-secondary);
  }

  &--focused:not(.blok-popover-item--no-focus) {
    background: var(--color-background-item-focus) !important;
  }

  &--hidden {
    @apply !hidden;
  }

  /* Hover styles - only on devices that support hover */
  @media (hover: hover) {
    &:hover {
      @apply cursor-pointer;
    }

    &:hover:not(.blok-popover-item--no-hover) {
      background-color: var(--color-background-item-hover);
    }
  }

  /* Force hover styles for Storybook/Chromatic testing */
  &--force-hover:not(.blok-popover-item--no-hover) {
    @apply cursor-pointer;
    background-color: var(--color-background-item-hover);
  }

  /* Confirmation state */
  &--confirmation {
    background: var(--color-background-item-confirm);

    .blok-popover-item__title,
    .blok-popover-item__icon {
      @apply text-white;
    }

    @media (hover: hover) {
      &:not(.blok-popover-item--no-hover):hover {
        background: var(--color-background-item-confirm-hover);
      }
    }

    &:not(.blok-popover-item--no-focus).blok-popover-item--focused {
      background: var(--color-background-item-confirm-hover) !important;
    }
  }
}

.blok-popover-item__icon {
  @apply flex items-center justify-center w-[26px] h-[26px] mobile:w-9 mobile:h-9 mobile:rounded-lg;

  svg {
    width: var(--icon-size);
    height: var(--icon-size);
    @apply mobile:w-7 mobile:h-7;
  }

  &--tool {
    @apply mr-1;
  }
}

.blok-popover-item__title {
  @apply text-sm leading-5 font-medium overflow-hidden whitespace-nowrap text-ellipsis mr-auto mobile:text-base;
}

.blok-popover-item__secondary-title {
  @apply text-xs whitespace-nowrap pr-1.5 opacity-60 tracking-[-0.1em] mobile:hidden;
  color: var(--color-text-secondary);
}

/**
 * Popover header styles
 */
.blok-popover-header__text {
  @apply text-lg font-semibold;
}

.blok-popover-header__back-button {
  @apply border-0 bg-transparent w-9 h-9;
  color: var(--color-text-primary);

  svg {
    @apply block w-7 h-7;
  }
}
