/**
 * Popover styles - Tailwind version
 *
 * Uses @apply where possible, CSS variables for dynamic values set via JS
 */

/* Popover CSS Variables - kept for JS integration and dynamic calculations */
.blok-popover {
  /* Design tokens */
  --border-radius: theme('borderRadius.lg');
  --width: 200px;
  --max-height: 270px;
  --padding: theme('spacing.1');
  --offset-from-target: theme('spacing.2');
  --color-border: theme('colors.gray.200', #eff0f1);
  --color-shadow: rgba(13, 20, 33, 0.1);
  --color-background: theme('colors.white');
  --color-text-primary: theme('colors.black');
  --color-text-secondary: theme('colors.gray.500', #707684);
  --color-border-icon: rgb(201 201 204 / 48%);
  --color-border-icon-disabled: theme('colors.gray.200', #eff0f1);
  --color-text-icon-active: theme('colors.blue.500', #388ae5);
  --color-background-icon-active: rgba(56, 138, 229, 0.1);
  --color-background-item-focus: rgba(34, 186, 255, 0.08);
  --color-shadow-item-focus: rgba(7, 161, 227, 0.08);
  --color-background-item-hover: theme('colors.gray.100', #f8f8f8);
  --color-background-item-confirm: theme('colors.red.500', #e24a4a);
  --color-background-item-confirm-hover: theme('colors.red.600', #ce4343);

  /* Positioning variables (set via JS) */
  --popover-top: calc(100% + var(--offset-from-target));
  --popover-left: 0;
  --nested-popover-overlap: theme('spacing.1');
  --icon-size: theme('spacing.5');
  --item-padding: 3px;
  --item-height: calc(var(--icon-size) + 2 * var(--item-padding));
}

.blok-popover__container {
  @apply absolute flex flex-col overflow-hidden box-border opacity-0 pointer-events-none p-0 border-none;
  min-width: var(--width);
  width: var(--width);
  border-radius: var(--border-radius);
  box-shadow: 0 3px 15px -3px var(--color-shadow);
  left: var(--popover-left);
  top: var(--popover-top);
  background: var(--color-background);
  z-index: 4;
  max-height: 0;
}

.blok-popover--opened > .blok-popover__container {
  @apply opacity-100 pointer-events-auto;
  padding: var(--padding);
  max-height: var(--max-height);
  animation: panelShowing 100ms ease;
  border: 1px solid var(--color-border);
}

@media (width <= 650px) {
  .blok-popover--opened > .blok-popover__container {
    animation: panelShowingMobile 250ms ease;
  }
}

.blok-popover--open-top .blok-popover__container {
  --popover-top: calc(-1 * (var(--offset-from-target) + var(--popover-height)));
}

.blok-popover--open-left .blok-popover__container {
  --popover-left: calc(-1 * var(--width) + 100%);
}

.blok-popover__items {
  @apply overflow-y-auto;
  overscroll-behavior: contain;
}

.blok-popover__overlay {
  @apply hidden;
}

@media (width <= 650px) {
  .blok-popover__overlay {
    @apply fixed inset-0 block visible;
    background: var(--color-dark);
    z-index: 3;
    opacity: 0.5;
    transition: opacity 0.12s ease-in;
    will-change: opacity;
  }

  .blok-popover__overlay--hidden {
    @apply hidden;
  }
}

/* Mobile container styles */
@media (width <= 650px) {
  .blok-popover .blok-popover__container {
    --offset: 5px;
    @apply fixed max-w-none;
    min-width: calc(100% - var(--offset) * 2);
    inset: auto var(--offset) calc(var(--offset) + env(safe-area-inset-bottom)) var(--offset);
    border-radius: 10px;
  }
}

.blok-popover__search {
  @apply mb-1.5;
}

.blok-popover__nothing-found-message {
  @apply hidden cursor-default text-sm leading-5 font-medium whitespace-nowrap overflow-hidden text-ellipsis;
  color: var(--grayText);
  padding: 3px;
}

.blok-popover__nothing-found-message--displayed {
  @apply block;
}

/* Nested popover positioning */
.blok-popover--nested .blok-popover__container {
  /* Variable --nesting-level is set via js in showNestedPopoverForItem() method */
  --popover-left: calc(var(--nesting-level) * (var(--width) - var(--nested-popover-overlap)));
  /* Variable --trigger-item-top is set via js in showNestedPopoverForItem() method */
  @apply absolute;
  top: calc(var(--trigger-item-top) - var(--nested-popover-overlap));
}

.blok-popover--open-top.blok-popover--nested .blok-popover__container {
  /* Bottom edge of nested popover should not be lower than bottom edge of parent popover when opened upwards */
  top: calc(var(--trigger-item-top) - var(--popover-height) + var(--item-height) + var(--offset-from-target) + var(--nested-popover-overlap));
}

.blok-popover--open-left .blok-popover--nested .blok-popover__container {
  --popover-left: calc(-1 * (var(--nesting-level) + 1) * var(--width) + 100%);
}

/**
 * Popover item separator
 */
.blok-popover-item-separator {
  padding: 4px 3px;
}

.blok-popover-item-separator--hidden {
  @apply hidden;
}

.blok-popover-item-separator__line {
  @apply h-px w-full;
  background: var(--color-border);
}

/**
 * Popover item HTML
 */
.blok-popover-item-html--hidden {
  @apply hidden;
}

/**
 * Popover item
 */
.blok-popover-item {
  --border-radius: theme('borderRadius.md');
  @apply flex items-center select-none border-none bg-transparent;
  border-radius: var(--border-radius);
  padding: var(--item-padding);
  color: var(--color-text-primary);
}

@media (width <= 650px) {
  .blok-popover-item {
    @apply p-1;
  }
}

.blok-popover-item:not(:last-of-type) {
  @apply mb-px;
}

.blok-popover-item__icon {
  @apply flex items-center justify-center;
  width: 26px;
  height: 26px;
}

.blok-popover-item__icon svg {
  width: var(--icon-size);
  height: var(--icon-size);
}

@media (width <= 650px) {
  .blok-popover-item__icon {
    @apply w-9 h-9 rounded-lg;
  }

  .blok-popover-item__icon svg {
    @apply w-7 h-7;
  }
}

.blok-popover-item__icon--tool {
  @apply mr-1;
}

.blok-popover-item__title {
  @apply text-sm leading-5 font-medium overflow-hidden whitespace-nowrap text-ellipsis mr-auto;
}

@media (width <= 650px) {
  .blok-popover-item__title {
    @apply text-base;
  }
}

.blok-popover-item__secondary-title {
  @apply text-xs whitespace-nowrap pr-1.5 opacity-60;
  color: var(--color-text-secondary);
  letter-spacing: -0.1em;
}

@media (width <= 650px) {
  .blok-popover-item__secondary-title {
    @apply hidden;
  }
}

.blok-popover-item--active {
  background: var(--color-background-icon-active);
  color: var(--color-text-icon-active);
}

.blok-popover-item--disabled {
  @apply cursor-default pointer-events-none;
  color: var(--color-text-secondary);
}

.blok-popover-item--focused:not(.blok-popover-item--no-focus) {
  background: var(--color-background-item-focus) !important;
}

.blok-popover-item--hidden {
  display: none !important;
}

/* Hover styles - only on devices that support hover */
@media (hover: hover) {
  .blok-popover-item:hover {
    @apply cursor-pointer;
  }

  .blok-popover-item:hover:not(.blok-popover-item--no-hover) {
    background-color: var(--color-background-item-hover);
  }
}

/* Force hover styles for Storybook/Chromatic testing */
.blok-popover-item--force-hover:not(.blok-popover-item--no-hover) {
  @apply cursor-pointer;
  background-color: var(--color-background-item-hover);
}

/* Confirmation state */
.blok-popover-item--confirmation {
  background: var(--color-background-item-confirm);
}

.blok-popover-item--confirmation .blok-popover-item__title,
.blok-popover-item--confirmation .blok-popover-item__icon {
  @apply text-white;
}

/* Confirmation hover */
@media (hover: hover) {
  .blok-popover-item--confirmation:not(.blok-popover-item--no-hover):hover {
    background: var(--color-background-item-confirm-hover);
  }
}

/* Confirmation focus */
.blok-popover-item--confirmation:not(.blok-popover-item--no-focus).blok-popover-item--focused {
  background: var(--color-background-item-confirm-hover) !important;
}

/**
 * Animations
 */
@keyframes panelShowing {
  from {
    @apply opacity-0;
    transform: translateY(-8px) scale(0.9);
  }
  70% {
    @apply opacity-100;
    transform: translateY(2px);
  }
  to {
    transform: translateY(0);
  }
}

@keyframes panelShowingMobile {
  from {
    @apply opacity-0;
    transform: translateY(14px) scale(0.98);
  }
  70% {
    @apply opacity-100;
    transform: translateY(-4px);
  }
  to {
    transform: translateY(0);
  }
}

.wobble {
  animation-name: wobble;
  animation-duration: 400ms;
}

/**
 * @author Nick Pettit - https://github.com/nickpettit/glide
 */
@keyframes wobble {
  from {
    transform: translate3d(0, 0, 0);
  }
  15% {
    transform: translate3d(-9%, 0, 0);
  }
  30% {
    transform: translate3d(9%, 0, 0);
  }
  45% {
    transform: translate3d(-4%, 0, 0);
  }
  60% {
    transform: translate3d(4%, 0, 0);
  }
  75% {
    transform: translate3d(-1%, 0, 0);
  }
  to {
    transform: translate3d(0, 0, 0);
  }
}

/**
 * Popover header styles
 */
.blok-popover-header {
  @apply flex items-center mb-2 mt-1;
}

.blok-popover-header__text {
  @apply text-lg font-semibold;
}

.blok-popover-header__back-button {
  @apply border-0 bg-transparent w-9 h-9;
  color: var(--color-text-primary);
}

.blok-popover-header__back-button svg {
  @apply block w-7 h-7;
}
