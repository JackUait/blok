/**
 * Popover styles - Tailwind version
 *
 * Uses theme() functions for static values, CSS variables only for dynamic values set via JS.
 * State-based styling uses data attributes for JavaScript integration.
 */

/* Popover CSS Variables - only dynamic values that are set via JS or used in complex calculations */
[data-blok-popover] {
  /* Layout tokens - specific to popover component */
  --width: 200px;
  --max-height: 270px;
  --item-padding: 3px;
  --item-height: calc(theme('spacing.5') + 2 * var(--item-padding));

  /* Dynamic positioning variables (set via JS) */
  --popover-top: calc(100% + theme('spacing.2'));
  --popover-left: 0;
  --nested-popover-overlap: theme('spacing.1');
}

[data-blok-popover-container] {
  @apply absolute flex flex-col overflow-hidden box-border opacity-0 pointer-events-none p-0 border-none z-[4] max-h-0;
  min-width: var(--width);
  width: var(--width);
  border-radius: theme('borderRadius.lg');
  box-shadow: 0 3px 15px -3px theme('colors.popover-shadow');
  left: var(--popover-left);
  top: var(--popover-top);
  background: theme('colors.popover-bg');

  /* Mobile container styles */
  @apply mobile:fixed mobile:max-w-none mobile:rounded-[10px];

  @screen mobile {
    --offset: 5px;
    min-width: calc(100% - var(--offset) * 2);
    inset: auto var(--offset) calc(var(--offset) + env(safe-area-inset-bottom)) var(--offset);
  }
}

[data-blok-popover-opened] > [data-blok-popover-container] {
  @apply opacity-100 pointer-events-auto;
  animation: panelShowing 100ms ease;
  padding: theme('spacing.1');
  max-height: var(--max-height);
  border: 1px solid theme('colors.popover-border');

  @screen mobile {
    animation: panelShowingMobile 250ms ease;
  }
}

[data-blok-popover-open-top] [data-blok-popover-container] {
  --popover-top: calc(-1 * (theme('spacing.2') + var(--popover-height)));
}


[data-blok-popover-open-left] [data-blok-popover-container] {
  --popover-left: calc(-1 * var(--width) + 100%);
}

[data-blok-popover-overlay] {
  @apply hidden bg-dark mobile:fixed mobile:inset-0 mobile:block mobile:visible mobile:z-[3] mobile:opacity-50 mobile:transition-opacity mobile:duration-[120ms] mobile:ease-in mobile:will-change-[opacity];
}

[data-blok-popover-overlay][data-blok-overlay-hidden] {
  @apply hidden;
}

/* Nested popover positioning */
[data-blok-nested] [data-blok-popover-container] {
  /* Variables --nesting-level and --trigger-item-top are set via JS */
  --popover-left: calc(var(--nesting-level) * (var(--width) - var(--nested-popover-overlap)));
  @apply absolute;
  top: calc(var(--trigger-item-top) - var(--nested-popover-overlap));
}

[data-blok-popover-open-top][data-blok-nested] [data-blok-popover-container] {
  top: calc(var(--trigger-item-top) - var(--popover-height) + var(--item-height) + theme('spacing.2') + var(--nested-popover-overlap));
}

[data-blok-popover-open-left] [data-blok-nested] [data-blok-popover-container] {
  --popover-left: calc(-1 * (var(--nesting-level) + 1) * var(--width) + 100%);
}

/**
 * Popover item separator
 */
[data-blok-popover-item-separator] {
  @apply py-1 px-[3px];
}

[data-blok-popover-item-separator][data-blok-hidden] {
  @apply hidden;
}

[data-blok-popover-item-separator-line] {
  @apply h-px w-full;
  background: theme('colors.popover-border');
}

/**
 * Popover item HTML
 */
[data-blok-popover-item-html][data-blok-hidden] {
  @apply hidden;
}

/**
 * Popover item
 */
[data-blok-popover-item] {
  @apply flex items-center select-none border-none bg-transparent rounded-md mobile:p-1;
  padding: var(--item-padding);
  color: theme('colors.text-primary');
}

[data-blok-popover-item]:not(:last-of-type) {
  @apply mb-px;
}

/* Hover styles - only on devices that support hover */
@screen can-hover {
  [data-blok-popover-item]:hover {
    @apply cursor-pointer;
  }

  [data-blok-popover-item]:hover:not([data-blok-popover-item-no-hover]) {
    background-color: theme('colors.item-hover-bg');
  }
}

[data-blok-popover-item][data-blok-popover-item-active] {
  background: theme('colors.icon-active-bg');
  color: theme('colors.icon-active-text');
}

[data-blok-popover-item][data-blok-disabled] {
  @apply cursor-default pointer-events-none;
  color: theme('colors.text-secondary');
}

[data-blok-popover-item][data-blok-focused]:not([data-blok-popover-item-no-focus]) {
  background: theme('colors.item-focus-bg') !important;
}

[data-blok-popover-item][data-blok-hidden] {
  @apply !hidden;
}

/* Force hover styles for Storybook/Chromatic testing */
[data-blok-popover-item][data-blok-force-hover]:not([data-blok-popover-item-no-hover]) {
  @apply cursor-pointer;
  background-color: theme('colors.item-hover-bg');
}

/* Confirmation state */
[data-blok-popover-item][data-blok-popover-item-confirmation] {
  background: theme('colors.item-confirm-bg');
}

[data-blok-popover-item][data-blok-popover-item-confirmation] [data-blok-popover-item-title],
[data-blok-popover-item][data-blok-popover-item-confirmation] [data-blok-popover-item-icon] {
  @apply text-white;
}

@screen can-hover {
  [data-blok-popover-item][data-blok-popover-item-confirmation]:not([data-blok-popover-item-no-hover]):hover {
    background: theme('colors.item-confirm-hover-bg');
  }
}

[data-blok-popover-item][data-blok-popover-item-confirmation]:not([data-blok-popover-item-no-focus])[data-blok-focused] {
  background: theme('colors.item-confirm-hover-bg') !important;
}

[data-blok-popover-item-icon] {
  @apply flex items-center justify-center w-[26px] h-[26px] mobile:w-9 mobile:h-9 mobile:rounded-lg;

  svg {
    @apply w-icon h-icon mobile:w-7 mobile:h-7;
  }
}

[data-blok-popover-item-icon][data-blok-tool] {
  @apply mr-2;
}

/* Wobble animation on error */
[data-blok-popover-item-icon][data-blok-popover-item-wobble] {
  @apply animate-wobble;
}

[data-blok-popover-item-title] {
  @apply text-sm leading-5 font-medium overflow-hidden whitespace-nowrap text-ellipsis mr-auto mobile:text-base;
}

[data-blok-popover-item-secondary-title] {
  @apply text-xs whitespace-nowrap pr-1.5 opacity-60 tracking-[-0.1em] mobile:hidden;
  color: theme('colors.text-secondary');
}

/**
 * Popover header styles
 */
[data-blok-popover-header-text] {
  @apply text-lg font-semibold;
}

[data-blok-popover-header-back-button] {
  @apply border-0 bg-transparent w-9 h-9;
  color: theme('colors.text-primary');

  svg {
    @apply block w-7 h-7;
  }
}
